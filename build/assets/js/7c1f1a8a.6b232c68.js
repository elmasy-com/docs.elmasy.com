"use strict";(self.webpackChunkwiki_elmasy_com=self.webpackChunkwiki_elmasy_com||[]).push([[354],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>f});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):d(d({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),p=s(n),u=r,f=p["".concat(l,".").concat(u)]||p[u]||c[u]||i;return n?a.createElement(f,d(d({ref:t},m),{},{components:n})):a.createElement(f,d({ref:t},m))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,d=new Array(i);d[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[p]="string"==typeof e?e:r,d[1]=o;for(var s=2;s<i;s++)d[s]=n[s];return a.createElement.apply(null,d)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},782:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const i={title:"mdadm",keywords:["mdadm","raid"],description:"Manage MD devices aka Linux Software RAID.",tags:["raid"]},d="mdadm",o={unversionedId:"guides/mdadm",id:"guides/mdadm",title:"mdadm",description:"Manage MD devices aka Linux Software RAID.",source:"@site/docs/guides/mdadm.md",sourceDirName:"guides",slug:"/guides/mdadm",permalink:"/guides/mdadm",draft:!1,editUrl:"https://github.com/elmasy-com/docs.elmasy.com/tree/main/docs/guides/mdadm.md",tags:[{label:"raid",permalink:"/tags/raid"}],version:"current",frontMatter:{title:"mdadm",keywords:["mdadm","raid"],description:"Manage MD devices aka Linux Software RAID.",tags:["raid"]},sidebar:"docSidebar",previous:{title:"MariaDB",permalink:"/guides/mariadb"},next:{title:"nftables",permalink:"/guides/nftables"}},l={},s=[{value:"RAID 0",id:"raid-0",level:2},{value:"fdisk",id:"fdisk",level:3},{value:"mdadm",id:"mdadm-1",level:3},{value:"mkfs",id:"mkfs",level:3},{value:"fstab",id:"fstab",level:3}],m={toc:s},p="wrapper";function c(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"mdadm"},"mdadm"),(0,r.kt)("h2",{id:"raid-0"},"RAID 0"),(0,r.kt)("p",null,"Create a Raid 0 with mdadm.\nI create the raid on partitions instead of on disks. Here is why: ",(0,r.kt)("a",{parentName:"p",href:"https://unix.stackexchange.com/questions/320103/whats-the-difference-between-creating-mdadm-array-using-partitions-or-the-whole"},"https://unix.stackexchange.com/questions/320103/whats-the-difference-between-creating-mdadm-array-using-partitions-or-the-whole"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The following commands are ran as ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", therefore ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," is omitted.")),(0,r.kt)("h3",{id:"fdisk"},"fdisk"),(0,r.kt)("p",null,"The type of the partitions will be ",(0,r.kt)("inlineCode",{parentName:"p"},"Linux RAID")," (code 29 on GPT)."),(0,r.kt)("p",null,"Create the partitions with fdisk:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fdisk /dev/sda\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Welcome to fdisk (util-linux 2.36.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\n\nCommand (m for help): g\nCreated a new GPT disklabel (GUID: ...).\n\nCommand (m for help): n\nPartition number (1-128, default 1): \nFirst sector (2048-976773134, default 2048): \nLast sector, +/-sectors or +/-size{K,M,G,T,P} (2048-976773134, default 976773134): \n\nCreated a new partition 1 of type 'Linux filesystem' and of size 465,8 GiB.\n\nCommand (m for help): t\nSelected partition 1\nPartition type or alias (type L to list all): 29\nChanged type of partition 'Linux filesystem' to 'Linux RAID'.\n\nCommand (m for help): w\nThe partition table has been altered.\nSyncing disks.\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fdisk /dev/sdb\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Welcome to fdisk (util-linux 2.36.1).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\n\nCommand (m for help): g\nCreated a new GPT disklabel (GUID: 75F9C784-617F-0149-8227-7615469591AF).\n\nCommand (m for help): n\nPartition number (1-128, default 1): \nFirst sector (2048-976773134, default 2048): \nLast sector, +/-sectors or +/-size{K,M,G,T,P} (2048-976773134, default 976773134): \n\nCreated a new partition 1 of type 'Linux filesystem' and of size 465,8 GiB.\n\nCommand (m for help): t\nSelected partition 1\nPartition type or alias (type L to list all): 29\nChanged type of partition 'Linux filesystem' to 'Linux RAID'.\n\nCommand (m for help): w\nThe partition table has been altered.\nSyncing disks.\n")),(0,r.kt)("p",null,"Or a use these simple oneliners:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo -e -n "g\\nn\\n\\n\\n\\nt\\n29\\nw\\n" | fdisk /dev/sda\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo -e -n "g\\nn\\n\\n\\n\\nt\\n29\\nw\\n" | fdisk /dev/sdb\n')),(0,r.kt)("h3",{id:"mdadm-1"},"mdadm"),(0,r.kt)("p",null,"Create the RAID 0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mdadm --create /dev/md0 --level=0 --raid-devices=2 /dev/sda1 /dev/sdb1\n")),(0,r.kt)("p",null,"Check the raid device:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat /proc/mdstat\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Personalities : [raid0] [linear] [multipath] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd0 : active raid0 sdb1[1] sda1[0]\n      976506880 blocks super 1.2 512k chunks\n      \nunused devices: <none>\n")),(0,r.kt)("p",null,"Save the array:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"update-initramfs -u\n")),(0,r.kt)("h3",{id:"mkfs"},"mkfs"),(0,r.kt)("p",null,"Create the filesystem on the new raid device:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkfs.ext4 /dev/md0\n")),(0,r.kt)("h3",{id:"fstab"},"fstab"),(0,r.kt)("p",null,"To auto mount at boot, edit ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/fstab"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo "/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0" >> /etc/fstab\n')))}c.isMDXComponent=!0}}]);